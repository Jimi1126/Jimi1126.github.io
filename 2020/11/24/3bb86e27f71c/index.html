<!DOCTYPE html>
<html>
  
<head>
  
  <!-- Favicons -->
  <link rel="icon shortcut" type="image/ico" href="/PGambler.svg">
  <link rel="icon" sizes="192x192" href="/PGambler.svg">
  <link rel="apple-touch-icon" href="/PGambler.svg">

  <!-- Meta & Info -->
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <meta name="theme-color" content="#fff">
  <meta name="author" content="PGambler">
  
  <meta name="keywords" content="hexo, blog,随记">

  <!--iOS -->
  <meta name="apple-mobile-web-app-title" content="PGambler">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="480">

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">

  <!-- The Open Graph protocol -->
  <meta property="og:url" content="https://github.com/PGambler/PGambler.github.io">
  <meta property="og:type" content="blog">
  <meta property="og:title" content="test - PGambler | PGambler">
  <meta property="og:image" content="/PGambler.svg" />
  
  
  <meta property="og:article:tag" content="随记">
  
  <title>PGambler</title>
  
<link rel="stylesheet" href="/css/index.min.css">

  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/fontawesome.min.css" rel="stylesheet">
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@tailwindcss/typography@0.4.x/dist/typography.min.css"
  />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <script src="https://kit.fontawesome.com/880bc416b5.js" crossorigin="anonymous"></script>
<meta name="generator" content="Hexo 5.4.0"></head>
  <body>
    <div class="flex flex-col items-center">
      <div style="flex: 1 1 3rem;">
  <div class="fixed left-0 top-0 flex justify-between w-full p-2 bg-gray-800 text-white">
    <div class="grid grid-cols-1 gap-2">
      <a class="the-btn" href="/" title="首页">
        <i class="fas fa-home"></i>
      </a>
    </div>

    <div class="grid grid-cols-4 gap-2">
      <div class="the-btn" title="搜索">
        <i class="fas fa-search"></i>
      </div>
      <div id="search" class="the-btn" title="关于我">
        <i class="fas fa-meh-blank"></i>
      </div>
      <div class="the-btn" title="gitbub">
        <i class="fab fa-github"></i>
      </div>
      <div id="theme" class="the-btn" title="主题">
        <i class="fas fa-sun"></i>
      </div>
    </div>
  </div>
</div>
      <div id="container" class="container flex-auto" style="min-height: calc(100vh - 6rem);">
         
<div class="antialiased text-gray-900">
  <div class="px-4 py-4 my-6 max-w-3xl mx-auto shadow-lg sm:px-6 sm:py-12 lg:max-w-4xl lg:py-16 lg:px-8 xl:max-w-6xl">
    <div class="flex flex-col items-center mb-4 mx-auto border-b border-gray-500">
      <span class="text-4xl break-all text-gray-500">前后端分离vue+springboot所遇到的跨域问题</span>
      <span class="grid grid-cols-2 gap-x-2 py-4 text-sm text-gray-500">
        <span class="flex items-center">
          <span>浏览数：20K</span>
        </span>
        <span class="flex items-center">
          <i class="fas fa-calendar-alt"></i>
          <span class="pl-1">2020-11-24</span>
        </span>
      </span>
    </div>
    <article class="prose prose-indigo prose-sm sm:prose lg:prose-lg xl:prose-xl 2xl:prose-2xl mx-auto">
      <h1 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h1><p>这是我第二次遇到此问题，特此记录解决方法。<br>跨域资源共享(CORS) 是一种机制，它使用额外的 HTTP 头来告诉浏览器  让运行在一个 origin (domain) 上的Web应用被准许访问来自不同源服务器上的指定的资源。当一个资源从与该资源本身所在的服务器不同的域、协议或端口请求一个资源时，资源会发起一个跨域 HTTP 请求。</p>
<span id="more"></span>
<p>比如，站点 <a target="_blank" rel="noopener" href="http://domain-a.com/">http://domain-a.com</a> 的某 HTML 页面通过 </p>
<p>出于安全原因，浏览器限制从脚本内发起的跨源HTTP请求。 例如，XMLHttpRequest和Fetch API遵循同源策略。 这意味着使用这些API的Web应用程序只能从加载应用程序的同一个域请求HTTP资源，除非响应报文包含了正确CORS响应头。 </p>
<p>（译者注：这段描述不准确，并不一定是浏览器限制了发起跨站请求，也可能是跨站请求可以正常发起，但是返回结果被浏览器拦截了。）</p>
<p>跨域资源共享（CORS ）机制允许 Web 应用服务器进行跨域访问控制，从而使跨域数据传输得以安全进行。现代浏览器支持在 API 容器中（例如 XMLHttpRequest 或Fetch）使用 CORS，以降低跨域 HTTP 请求所带来的风险。</p>
<p>摘自：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS</a></p>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><h2 id="通过编写中间件（过滤器、适配器）"><a href="#通过编写中间件（过滤器、适配器）" class="headerlink" title="通过编写中间件（过滤器、适配器）"></a>通过编写中间件（过滤器、适配器）</h2><p>这里我通过滤器实现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">package com.example.redisdemo.config;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">import javax.servlet.Filter;</span><br><span class="line">import javax.servlet.FilterChain;</span><br><span class="line">import javax.servlet.FilterConfig;</span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.ServletRequest;</span><br><span class="line">import javax.servlet.ServletResponse;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class CorsFilter implements Filter &#123;</span><br><span class="line"></span><br><span class="line">    /*跨域请求配置*/</span><br><span class="line">    @Override</span><br><span class="line">    public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) throws IOException, ServletException &#123;</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) res;</span><br><span class="line">        response.setHeader(&quot;Access-Control-Allow-Origin&quot;,&quot;*&quot;);</span><br><span class="line">        response.setHeader(&quot;Access-Control-Allow-Credentials&quot;, &quot;true&quot;);</span><br><span class="line">        response.setHeader(&quot;Access-Control-Allow-Methods&quot;, &quot;POST, PUT, GET, OPTIONS, DELETE&quot;);</span><br><span class="line">        response.setHeader(&quot;Access-Control-Max-Age&quot;, &quot;5000&quot;);</span><br><span class="line">        response.setHeader(&quot;Access-Control-Expose-Headers&quot;, &quot;Token&quot;);</span><br><span class="line">        response.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;Origin, No-Cache, X-Requested-With, If-Modified-Since, Pragma, Last-Modified, Cache-Control, Expires, Content-Type, X-E4M-With,Authorization,Token&quot;);</span><br><span class="line">        chain.doFilter(req, res);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void init(FilterConfig filterConfig) &#123;&#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void destroy() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从该过滤器可看到，它将请求的响应体进行了部分设置，包括：<br>Access-Control-Allow-Origin：访问源控制<br>Access-Control-Allow-Credentials：是否返回cookie<br>Access-Control-Allow-Methods：处理发送请求方式<br>Access-Control-Expose-Headers：允许暴露给前端的属性<br>Access-Control-Allow-Headers：允许前端访问携带的属性</p>
<h2 id="通过Spring注解的方式"><a href="#通过Spring注解的方式" class="headerlink" title="通过Spring注解的方式"></a>通过Spring注解的方式</h2><p>为请求handler或controller添加@CrossOrigin允许跨源请求注解，默认允许所有的域以及允许所有的header。</p>
<p>详见：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/4.2.7.RELEASE/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html">https://docs.spring.io/spring/docs/4.2.7.RELEASE/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html</a></p>

    </article>
    <div class="grid grid-cols-2 gap-x-2 p-3 m-3 mx-auto border-t border-gray-500">
      <span class="flex flex-col">
         
        <a class="flex items-center" href="/2020/11/24/e239fbf527a5/">
          <i class="fas fa-angle-left"></i>
          <span class="pl-1">上一篇</span>
        </a>
        <a class="truncate" href="/2020/11/24/e239fbf527a5/">springIOC相关注册注解及接口</a>
         
      </span>
      <span class="w-full flex flex-col justify-self-end">
         
        <a class="flex justify-end items-center" href="/2020/11/24/f8afecf942d8/">
          <span class="pr-1">下一篇</span>
          <i class="fas fa-angle-right"></i>
        </a>
        <a class="text-right truncate" href="/2020/11/24/f8afecf942d8/">字符转换大字符</a>
         
      </span>
    </div>
  </div>
  <div class="toc-wrap hidden text-xs sm:text-sm lg:text-base xl:text-lg">
    <p class="p-3 pb-1 mb-2 border-b border-solid border-gray-800">目录</p>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F"><span class="toc-number">1.</span> <span class="toc-text">跨域</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%BC%96%E5%86%99%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BC%88%E8%BF%87%E6%BB%A4%E5%99%A8%E3%80%81%E9%80%82%E9%85%8D%E5%99%A8%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">通过编写中间件（过滤器、适配器）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87Spring%E6%B3%A8%E8%A7%A3%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text">通过Spring注解的方式</span></a></li></ol></li></ol>
  </div>
</div> 
      </div>
      <div class="flex flex-col justify-center items-center w-full bg-gray-800 text-white text-xs" style="flex: 1 1 3rem;">
  <div class="divide-x">
    <span class="pr-1">本站浏览总访问量：100</span>
    <span class="pl-1">本站访问人数：10</span>
  </div>
  <div class="divide-x">
    <span class="pr-1">&copy;PGambler</span>
    <span class="px-1">Powered by <a href="http://hexo.io" target="_blank" class="text-blue-400">Hexo</a></span>
    <span class="pl-1">Theme - <a href="//github.com/Halyul/hexo-theme-mdui" target="_blank"  class="text-blue-400">PGambler</a></span>
  </div>
</div>
    </div>
  </body>
  <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?94d58b73336d471470a480cea85af875";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
  
<script src="/js/main.bundle.js"></script>
</html>